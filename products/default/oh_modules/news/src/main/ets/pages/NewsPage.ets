import { BaiduHotSearchParser } from 'utils';
import webview from '@ohos.web.webview';
/*
 * Copyright (c) 2024 Huawei Device Co., Ltd.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * News data entity.
 */
class NewsData {
  /**
   * News ID.
   */
  id: number;

  /**
   * News title.
   */
  title: string;

  /**
   * News summary.
   */
  summary: string;

  /**
   * News source.
   */
  source: string;

  /**
   * News publish time.
   */
  publishTime: string;

  /**
   * News image URL.
   */
  imageUrl: Resource | string | null;

  /**
   * News detail url.
   */
  detailUrl: string | null;

  /**
   * News category.
   */
  category: string;

  /**
   * News read count.
   */
  readCount: number;

  /**
   * Whether news is hot.
   */
  isHot: boolean;

  /**
   * Whether news is top.
   */
  isTop: boolean;

  constructor(
    id: number,
    title: string,
    summary: string,
    source: string,
    publishTime: string,
    imageUrl: Resource | string | null,
    category: string,
    readCount: number,
    isHot: boolean = false,
    isTop: boolean = false,
    detailUrl: string | null = null
  ) {
    this.id = id;
    this.title = title;
    this.summary = summary;
    this.source = source;
    this.publishTime = publishTime;
    this.imageUrl = imageUrl;
    this.category = category;
    this.readCount = readCount;
    this.isHot = isHot;
    this.isTop = isTop;
    this.detailUrl = detailUrl;
  }
}

/**
 * Main view model for news data.
 */
class MainViewModel {
  /**
   * Get hot news data.
   *
   * @return {Array<NewsData>} hotNewsData.
   */
  getHotNewsData(): Array<NewsData> {
    let hotNewsData: NewsData[] = [
      new NewsData(
        1,
        "ç§‘æŠ€çªç ´ï¼šäººå·¥æ™ºèƒ½åœ¨åŒ»ç–—é¢†åŸŸå–å¾—é‡å¤§è¿›å±•",
        "æœ€æ–°ç ”ç©¶æ˜¾ç¤ºï¼ŒAIæŠ€æœ¯åœ¨ç–¾ç—…è¯Šæ–­å’Œæ²»ç–—æ–¹æ¡ˆåˆ¶å®šæ–¹é¢å±•ç°å‡ºå·¨å¤§æ½œåŠ›...",
        "ç§‘æŠ€æ—¥æŠ¥",
        "2å°æ—¶å‰",
        $r('app.media.fig1'),
        "ç§‘æŠ€",
        125000,
        true,
        true
      ),
      new NewsData(
        2,
        "ç»æµè§‚å¯Ÿï¼šå…¨çƒè‚¡å¸‚éœ‡è¡ï¼ŒæŠ•èµ„è€…éœ€è°¨æ…",
        "å—å¤šé‡å› ç´ å½±å“ï¼Œå…¨çƒä¸»è¦è‚¡å¸‚å‡ºç°ä¸åŒç¨‹åº¦æ³¢åŠ¨ï¼Œä¸“å®¶å»ºè®®ç†æ€§æŠ•èµ„...",
        "è´¢ç»ç½‘",
        "3å°æ—¶å‰",
        $r('app.media.fig2'),
        "è´¢ç»",
        89000,
        true,
        false
      ),
      new NewsData(
        3,
        "æ•™è‚²æ”¹é©ï¼šæ–°è¯¾ç¨‹æ ‡å‡†æ­£å¼å‘å¸ƒ",
        "æ•™è‚²éƒ¨å‘å¸ƒæœ€æ–°è¯¾ç¨‹æ ‡å‡†ï¼Œå¼ºè°ƒç´ è´¨æ•™è‚²ä¸åˆ›æ–°èƒ½åŠ›åŸ¹å…»...",
        "æ•™è‚²æ—¶æŠ¥",
        "5å°æ—¶å‰",
        $r('app.media.fig3'),
        "æ•™è‚²",
        67000,
        true,
        false
      )
    ];
    return hotNewsData;
  }

  /**
   * Get news list data.
   *
   * @return {Array<NewsData>} newsListData.
   */
  getNewsListData(): Array<NewsData> {
    let newsListData: NewsData[] = [
      new NewsData(
        4,
        "ç¯ä¿è¡ŒåŠ¨ï¼šå¤šåœ°å¯åŠ¨ç»¿è‰²å‡ºè¡Œè®¡åˆ’",
        "ä¸ºå‡å°‘ç¢³æ’æ”¾ï¼Œå¤šä¸ªåŸå¸‚æ¨å‡ºç»¿è‰²å‡ºè¡Œæ¿€åŠ±æ”¿ç­–...",
        "ç¯ä¿æ—¥æŠ¥",
        "6å°æ—¶å‰",
        $r('app.media.fig4'),
        "ç¯ä¿",
        43000,
        false,
        false
      ),
      new NewsData(
        5,
        "ä½“è‚²èµ›äº‹ï¼šä¸–ç•Œæ¯é¢„é€‰èµ›ç²¾å½©å›é¡¾",
        "å¤šæ”¯å¼ºé˜Ÿåœ¨é¢„é€‰èµ›ä¸­å±•ç°å‡ºè‰²è¡¨ç°ï¼Œä¸ºå³å°†åˆ°æ¥çš„æ­£èµ›åšå‡†å¤‡...",
        "ä½“è‚²å‘¨æŠ¥",
        "8å°æ—¶å‰",
        $r('app.media.fig1'),
        "ä½“è‚²",
        56000,
        false,
        false
      ),
      new NewsData(
        6,
        "æ–‡åŒ–ä¼ æ‰¿ï¼šéç‰©è´¨æ–‡åŒ–é—äº§ä¿æŠ¤å·¥ä½œå–å¾—æ–°è¿›å±•",
        "å„åœ°åŠ å¤§éé—ä¿æŠ¤åŠ›åº¦ï¼Œè®©ä¼ ç»Ÿæ–‡åŒ–åœ¨æ–°æ—¶ä»£ç„•å‘æ–°æ´»åŠ›...",
        "æ–‡åŒ–å‘¨åˆŠ",
        "10å°æ—¶å‰",
        $r('app.media.fig2'),
        "æ–‡åŒ–",
        32000,
        false,
        false
      ),
      new NewsData(
        7,
        "å¥åº·ç”Ÿæ´»ï¼šä¸“å®¶å»ºè®®çš„å†¬å­£å…»ç”ŸæŒ‡å—",
        "å†¬å­£æ˜¯å…»ç”Ÿçš„å…³é”®æ—¶æœŸï¼Œä¸“å®¶æé†’æ³¨æ„é¥®é£Ÿè°ƒç†å’Œé€‚åº¦è¿åŠ¨...",
        "å¥åº·æ—¶æŠ¥",
        "12å°æ—¶å‰",
        $r('app.media.fig3'),
        "å¥åº·",
        28000,
        false,
        false
      )
    ];
    return newsListData;
  }

  /**
   * Get news categories.
   *
   * @return {Array<string>} categories.
   */
  getNewsCategories(): Array<string> {
    return ["çƒ­æœ", "è´¢ç»", "æ°‘ç”Ÿ", "ä½“è‚²"];
  }

  /**
   * Format read count.
   *
   * @param {number} count - read count.
   * @return {string} formatted count.
   */
  formatReadCount(count: number): string {
    if (count >= 10000) {
      return Math.floor(count / 10000) + "ä¸‡";
    } else if (count >= 1000) {
      return Math.floor(count / 1000) + "k";
    } else {
      return count.toString();
    }
  }

  /**
   * Get mock hot news data as fallback.
   *
   * @return {Array<NewsData>} hotNewsData.
   */
  getMockHotNewsData(): Array<NewsData> {
    return [
      new NewsData(
        1,
        "ç§‘æŠ€çªç ´ï¼šäººå·¥æ™ºèƒ½åœ¨åŒ»ç–—é¢†åŸŸå–å¾—é‡å¤§è¿›å±•",
        "æœ€æ–°ç ”ç©¶æ˜¾ç¤ºï¼ŒAIæŠ€æœ¯åœ¨ç–¾ç—…è¯Šæ–­å’Œæ²»ç–—æ–¹æ¡ˆåˆ¶å®šæ–¹é¢å±•ç°å‡ºå·¨å¤§æ½œåŠ›...",
        "ç§‘æŠ€æ—¥æŠ¥",
        "2å°æ—¶å‰",
        $r('app.media.fig1'),
        "ç§‘æŠ€",
        125000,
        true,
        true
      ),
      new NewsData(
        2,
        "ç»æµè§‚å¯Ÿï¼šå…¨çƒè‚¡å¸‚éœ‡è¡ï¼ŒæŠ•èµ„è€…éœ€è°¨æ…",
        "å—å¤šé‡å› ç´ å½±å“ï¼Œå…¨çƒä¸»è¦è‚¡å¸‚å‡ºç°ä¸åŒç¨‹åº¦æ³¢åŠ¨ï¼Œä¸“å®¶å»ºè®®ç†æ€§æŠ•èµ„...",
        "è´¢ç»ç½‘",
        "3å°æ—¶å‰",
        $r('app.media.fig2'),
        "è´¢ç»",
        89000,
        true,
        false
      )
    ];
  }
}

/**
 * News page component with all functionality integrated.
 */
@Component
export struct NewsPage {
  @State currentCategory: string = "çƒ­æœ";
  @State hotNewsData: NewsData[] = [];
  @State categories: string[] = [];
  @State searchText: string = '';
  @State showSearchAction: boolean = false;
  @State isLoading: boolean = false;
  @State selectedNewsUrl: string | null = null;
  private mainViewModel: MainViewModel = new MainViewModel();
  private detailWebController: webview.WebviewController = new webview.WebviewController();

  async aboutToAppear() {
    this.categories = this.mainViewModel.getNewsCategories();
    if (this.categories.length > 0) {
      this.currentCategory = this.categories[0];
    }
    await this.loadHotNewsData(this.currentCategory);
  }

  /**
   * åŠ è½½çƒ­æœæ•°æ®
   */
    private getTabKeyForCategory(category: string): string {
    switch (category) {
      case 'è´¢ç»':
        return 'finance';
      case 'æ°‘ç”Ÿ':
        return 'livelihood';
      case 'ä½“è‚²':
        return 'sports';
      default:
        return 'realtime';
    }
  }

  async loadHotNewsData(category?: string) {
    const targetCategory: string = category ?? this.currentCategory;
    this.isLoading = true;
    try {
      const tabKey: string = this.getTabKeyForCategory(targetCategory);
      const hotItems = await BaiduHotSearchParser.getHotSearchData(tabKey);
      const sourceLabel: string = targetCategory === 'çƒ­æœ' ? 'ç™¾åº¦çƒ­æœ' : `ç™¾åº¦${targetCategory}æ¦œ`;
      this.hotNewsData = hotItems.map((it, idx) => {
        const detailUrl: string | undefined = it.rawUrl && it.rawUrl.length > 0 ? it.rawUrl : it.linkurl;
        const imageSource: string | undefined = targetCategory === 'çƒ­æœ' && it.imageUrl && it.imageUrl.length > 0 ? it.imageUrl : undefined;
        return new NewsData(
          idx + 1,
          it.card_title,
          '',
          sourceLabel,
          '',
          imageSource ?? null,
          targetCategory,
          parseInt(it.heat_score || '0') || 0,
          true,
          idx < 3,
          detailUrl ?? null
        );
      });
      this.currentCategory = targetCategory;
    } catch (error) {
      console.error('è·å–æ¦œå•æ•°æ®å¤±è´¥:', error);
      this.hotNewsData = this.mainViewModel.getMockHotNewsData();
    } finally {
      this.isLoading = false;
    }
  }

  private onCategorySelected(category: string): void {
    if (this.currentCategory === category) {
      return;
    }
    this.currentCategory = category;
    this.loadHotNewsData(category).catch((error: Error) => {
      console.error('åˆ‡æ¢æ¦œå•å¤±è´¥:', error);
    });
  }

  private openNewsDetail(news: NewsData): void {
    if (!news.detailUrl || news.detailUrl.length === 0) {
      this.getUIContext().getPromptAction().showToast({
        message: 'æš‚æœªæä¾›æœ‰æ•ˆé“¾æ¥'
      });
      return;
    }
    this.selectedNewsUrl = news.detailUrl;
  }

  private closeNewsDetail(): void {
    this.selectedNewsUrl = null;
  }

  /**
   * Build enhanced search bar.
   */
  @Builder
  buildSearchBar() {
    Row() {
      // æœç´¢æ¡†åŒºåŸŸ
      Row() {
        Image($r('app.media.sift')) // æœç´¢å›¾æ ‡
          .width('16vp')
          .height('16vp')
          .margin({ left: '12vp', right: '8vp' })
          .fillColor('#999999')

        TextInput({ placeholder: 'æœç´¢æ–°é—»', text: this.searchText })
          .fontSize('14fp')
          .fontColor('#182431')
          .backgroundColor(Color.Transparent)
          .placeholderColor('#999999')
          .layoutWeight(1)
          .onChange((value: string) => {
            this.searchText = value;
            this.showSearchAction = value.length > 0;
          })

        if (this.showSearchAction) {
          Image($r('app.media.sift')) // æ¸…é™¤å›¾æ ‡
            .width('14vp')
            .height('14vp')
            .margin({ right: '12vp' })
            .fillColor('#999999')
            .onClick(() => {
              this.searchText = '';
              this.showSearchAction = false;
            })
        }
      }
      .height('36vp')
      .backgroundColor('#FFFFFF')
      .borderRadius('18vp')
      .border({ width: '1vp', color: '#E5E5E5' })
      .layoutWeight(1)

      // æ“ä½œæŒ‰é’®
      Row() {
        Image($r('app.media.message')) // æ¶ˆæ¯å›¾æ ‡
          .width('20vp')
          .height('20vp')
          .margin({ left: '12vp', right: '12vp' })
          .fillColor('#333333')
          .onClick(() => {
            // å¤„ç†æ¶ˆæ¯ç‚¹å‡»
          })

        Image($r('app.media.menu')) // åˆ·æ–°å›¾æ ‡
          .width('20vp')
          .height('20vp')
          .margin({ right: '4vp' })
          .fillColor('#333333')
          .onClick(() => {
            // åˆ·æ–°æ¦œå•æ•°æ®
            this.loadHotNewsData(this.currentCategory);
          })

        // æµ‹è¯•æŒ‰é’®
        Text('æµ‹è¯•')
          .fontSize('12fp')
          .fontColor('#007DFF')
          .margin({ right: '4vp' })
          .onClick(async () => {
            // æµ‹è¯•çˆ¬å–åŠŸèƒ½
            console.log('ğŸ§ª ç”¨æˆ·ç‚¹å‡»æµ‹è¯•æŒ‰é’®');
            try {
              // è¿™é‡Œå¯ä»¥è°ƒç”¨æµ‹è¯•æ–¹æ³•
              console.log('å¼€å§‹æµ‹è¯•çˆ¬å–åŠŸèƒ½...');
            } catch (error) {
              console.error('æµ‹è¯•å¤±è´¥:', error);
            }
          })
      }
      .height('36vp')
      .alignItems(VerticalAlign.Center)
    }
    .width('100%')
    .padding({ left: '12vp', right: '8vp', top: '8vp', bottom: '8vp' })
    .alignItems(VerticalAlign.Center)
  }

  /**
   * Build enhanced category tab.
   */
  @Builder
  buildCategoryTab(category: string, index: number) {
    Column() {
      Text(category)
        .fontSize(this.currentCategory === category ? '16fp' : '14fp')
        .fontColor(this.currentCategory === category ? '#007DFF' : '#666666')
        .fontWeight(this.currentCategory === category ? FontWeight.Medium : FontWeight.Normal)
        .padding({ left: '16vp', right: '16vp', top: '8vp', bottom: '8vp' })

      // é€‰ä¸­æŒ‡ç¤ºå™¨
      if (this.currentCategory === category) {
        Column() {
          // ä½¿ç”¨ç©ºçš„ Column ä½œä¸ºæŒ‡ç¤ºå™¨ï¼Œé€šè¿‡èƒŒæ™¯è‰²å®ç°
        }
        .width('20vp')
        .height('3vp')
        .backgroundColor('#007DFF')
        .borderRadius('2vp')
        .margin({ top: '2vp' })
      }
    }
    .alignItems(HorizontalAlign.Center)
    .onClick(() => {
      this.onCategorySelected(category);
    })
  }

  /**
   * Build enhanced hot news item.
   */
  @Builder
  buildHotNewsItem(news: NewsData, index: number) {
    Column() {
      Row() {
        // æ’åæ ‡è¯†
        if (index < 3) {
          Text((index + 1).toString())
            .fontSize('14fp')
            .fontColor(Color.White)
            .fontWeight(FontWeight.Bold)
            .width('20vp')
            .height('20vp')
            .textAlign(TextAlign.Center)
            .backgroundColor(index === 0 ? '#FF4444' : index === 1 ? '#FF8800' : '#FFAA00')
            .borderRadius('10vp')
            .margin({ right: '8vp' })
        } else {
          Text((index + 1).toString())
            .fontSize('12fp')
            .fontColor('#999999')
            .width('16vp')
            .height('16vp')
            .textAlign(TextAlign.Center)
            .backgroundColor('#F0F0F0')
            .borderRadius('8vp')
            .margin({ right: '8vp' })
        }

        Column() {
          Text(news.title)
            .fontSize('15fp')
            .fontWeight(FontWeight.Medium)
            .fontColor('#182431')
            .maxLines(2)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .margin({ bottom: '6vp' })
            .textAlign(TextAlign.Start)
            .lineHeight('20fp')

          Row() {
            Text(news.source)
              .fontSize('11fp')
              .fontColor('#999999')

            Text('Â·')
              .fontSize('11fp')
              .fontColor('#999999')
              .margin({ left: '4vp', right: '4vp' })

            Text(news.publishTime)
              .fontSize('11fp')
              .fontColor('#999999')

            Blank()

            Text(this.mainViewModel.formatReadCount(news.readCount))
              .fontSize('11fp')
              .fontColor('#999999')
          }
          .width('100%')
          .alignItems(VerticalAlign.Center)
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)

        if (typeof news.imageUrl === 'string') {
          Image(news.imageUrl as string)
            .width('70vp')
            .height('50vp')
            .borderRadius('6vp')
            .objectFit(ImageFit.Cover)
        } else if (news.imageUrl) {
          Image(news.imageUrl as Resource)
            .width('70vp')
            .height('50vp')
            .borderRadius('6vp')
            .objectFit(ImageFit.Cover)
        }
      }
      .width('100%')
      .alignItems(VerticalAlign.Top)

      // åˆ†éš”çº¿
      if (index < this.hotNewsData.length - 1) {
        Divider()
          .strokeWidth('0.5vp')
          .color('#F0F0F0')
          .margin({ top: '12vp', bottom: '4vp' })
      }
    }
    .width('100%')
    .padding({ top: '8vp', bottom: '8vp' })
    .onClick(() => {
      this.openNewsDetail(news);
    })
  }

  /**
   * Build enhanced news list item.
   */
  @Builder
  buildNewsListItem(news: NewsData) {
    Column() {
      Row() {
        Column() {
          // æ ‡ç­¾åŒºåŸŸ
          if (news.isHot || news.isTop || news.category) {
            Row() {
              if (news.isHot) {
                Text('çƒ­')
                  .fontSize('10fp')
                  .fontColor(Color.White)
                  .backgroundColor('#FF4444')
                  .padding({ left: '6vp', right: '6vp', top: '2vp', bottom: '2vp' })
                  .borderRadius('4vp')
                  .margin({ right: '6vp' })
              }

              if (news.isTop) {
                Text('ç½®é¡¶')
                  .fontSize('10fp')
                  .fontColor(Color.White)
                  .backgroundColor('#FF8800')
                  .padding({ left: '6vp', right: '6vp', top: '2vp', bottom: '2vp' })
                  .borderRadius('4vp')
                  .margin({ right: '6vp' })
              }

              if (news.category) {
                Text(news.category)
                  .fontSize('10fp')
                  .fontColor('#007DFF')
                  .backgroundColor('#E6F3FF')
                  .padding({ left: '6vp', right: '6vp', top: '2vp', bottom: '2vp' })
                  .borderRadius('4vp')
              }
            }
            .margin({ bottom: '8vp' })
            .alignItems(VerticalAlign.Center)
          }

          Text(news.title)
            .fontSize('16fp')
            .fontWeight(FontWeight.Medium)
            .fontColor('#182431')
            .maxLines(3)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .margin({ bottom: '6vp' })
            .textAlign(TextAlign.Start)
            .lineHeight('21fp')

          if (news.summary) {
            Text(news.summary)
              .fontSize('13fp')
              .fontColor('#666666')
              .maxLines(2)
              .textOverflow({ overflow: TextOverflow.Ellipsis })
              .margin({ bottom: '8vp' })
              .textAlign(TextAlign.Start)
              .lineHeight('17fp')
          }

          Row() {
            Text(news.source)
              .fontSize(12)
              .fontColor('#999999')

            Text('Â·')
              .fontSize(12)
              .fontColor('#999999')
              .margin({ left: 6, right: 6 })

            Text(news.publishTime)
              .fontSize(12)
              .fontColor('#999999')

            Blank()

            Row() {
              Image($r('app.media.message')) // è¯„è®ºå›¾æ ‡
                .width(12)
                .height(12)
                .margin({ right: 4 })
                .fillColor('#999999')

              Text(this.mainViewModel.formatReadCount(news.readCount))
                .fontSize(12)
                .fontColor('#999999')
            }
            .alignItems(VerticalAlign.Center)
          }
          .width('100%')
          .alignItems(VerticalAlign.Center)
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)

        if (typeof news.imageUrl === 'string') {
          Image(news.imageUrl as string)
            .width(100)
            .height(75)
            .borderRadius(8)
            .objectFit(ImageFit.Cover)
            .margin({ left: 12 })
        } else if (news.imageUrl) {
          Image(news.imageUrl as Resource)
            .width(100)
            .height(75)
            .borderRadius(8)
            .objectFit(ImageFit.Cover)
            .margin({ left: 12 })
        }
      }
      .width('100%')
      .alignItems(VerticalAlign.Top)
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .margin({ bottom: 8, left: 12, right: 12 })
    .shadow({ radius: 8, color: '#1A000000', offsetX: 0, offsetY: 2 })
    .onClick(() => {
      this.openNewsDetail(news);
    })
  }

  @Builder
  buildMainLayout() {
    Column() {
      // Search bar
      this.buildSearchBar()

      // Category tabs with background
      Column() {
        Scroll() {
          Row({ space: 8 }) {
            ForEach(this.categories, (category: string, index: number) => {
              this.buildCategoryTab(category, index)
            })
          }
          .padding({ left: '12vp', right: '12vp' })
        }
        .scrollable(ScrollDirection.Horizontal)
        .scrollBar(BarState.Off)
        .height('48vp')
      }
      .width('100%')
      .backgroundColor(Color.White)
      .shadow({ radius: 4, color: '#0A000000', offsetX: 0, offsetY: 1 })

      // Content area
      Scroll() {
        Column() {
          // æ¦œå•æ•°æ®å±•ç¤º
          Column() {
            // æ¦œå•æ ‡é¢˜
            Row() {
              Text(this.currentCategory + 'æ¦œ')
                .fontSize(18)
                .fontWeight(FontWeight.Bold)
                .fontColor('#182431')

              Blank()

              if (this.isLoading) {
                LoadingProgress()
                  .width('16vp')
                  .height('16vp')
                  .margin({ right: '8vp' })
              }

              Text('æ›´å¤š')
                .fontSize(13)
                .fontColor('#999999')
                .onClick(() => {
                  this.loadHotNewsData(this.currentCategory);
                })
            }
            .width('100%')
            .padding({ left: 20, right: 20, top: 16, bottom: 12 })

            // æ¦œå•åˆ—è¡¨
            Column() {
              ForEach(this.hotNewsData, (news: NewsData, index: number) => {
                this.buildHotNewsItem(news, index)
              })
            }
            .width('100%')
            .padding({ left: 20, right: 20 })
            .backgroundColor(Color.White)
            .borderRadius(12)
            .margin({ bottom: 16, left: 12, right: 12 })
            .shadow({ radius: 8, color: '#1A000000', offsetX: 0, offsetY: 2 })
          }

        }
      }
      .scrollBar(BarState.Off)
      .layoutWeight(1)
    }
    .padding({ top: '48vp' })
    .width('100%')
    .height('100%')
    .backgroundColor('#F8F9FA')
  }

  @Builder
  buildDetailLayer(url: string) {
    Column() {
      Row() {
        Text('å…³é—­')
          .fontSize(16)
          .fontColor('#E60012')
          .padding({ left: 16, right: 16, top: 16, bottom: 16 })
          .onClick(() => {
            this.closeNewsDetail();
          })

        Blank()

        Text('æ–°é—»è¯¦æƒ…')
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .fontColor('#182431')
          .margin({ right: 24 })
      }
      .width('100%')
      .backgroundColor('#FFFFFF')

      Web({ src: url, controller: this.detailWebController })
        .layoutWeight(1)
        .width('100%')
    }
    .padding({ top: '48vp' })
    .width('100%')
    .height('100%')
    .backgroundColor('#FFFFFF')
  }

  build() {
    Stack({ alignContent: Alignment.TopStart }) {
      this.buildMainLayout();

      if (this.selectedNewsUrl !== null) {
        this.buildDetailLayer(this.selectedNewsUrl as string);
      }
    }
    .width('100%')
    .height('100%')
  }
}
